{"version":3,"sources":["uni-app:///main.js","webpack:///D:/www/haisiteng/uniapp_vue2/pages/my/confirm_order/confirm_order.vue?0b55","webpack:///D:/www/haisiteng/uniapp_vue2/pages/my/confirm_order/confirm_order.vue?da2f","webpack:///D:/www/haisiteng/uniapp_vue2/pages/my/confirm_order/confirm_order.vue?e991","webpack:///D:/www/haisiteng/uniapp_vue2/pages/my/confirm_order/confirm_order.vue?9cf8","uni-app:///pages/my/confirm_order/confirm_order.vue"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","from_cart","current","ans_list","goods_list","express","amount","total","amount_goods","amount_integral","express_amount","discount_amount","amount_real","orderLoading","loaded","coupon","available","unavailable","used","coupon_id","switchChecked","integral_available","use_available","coupon_available_opens","coupon_unavailable_opens","computed","total_order_amount","total_order_amount_ceil","couponTabsLabel","address_current","address_current_id","onLoad","onShow","axios","address_list","methods","openCouponPopup","onNotUseCoupon","onCouponUse","onClickItem","onSwitchChange","pay","console","uni","title","icon","res","number","order_no","paymentRes","success","url","resetPay","setTimeout","createParams","items","params","loadData","duration"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,sBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAA0H;AAC1H;AACiE;AACL;;;AAG5D;AACkL;AAClL,gBAAgB,sLAAU;AAC1B,EAAE,mFAAM;AACR,EAAE,wFAAM;AACR,EAAE,iGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,4FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,iVAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,uSAEN;AACP,KAAK;AACL;AACA,aAAa,iSAEN;AACP,KAAK;AACL;AACA,aAAa,qUAEN;AACP,KAAK;AACL;AACA,aAAa,iSAEN;AACP,KAAK;AACL;AACA,aAAa,6SAEN;AACP,KAAK;AACL;AACA,aAAa,6SAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,4WAEN;AACP,KAAK;AACL;AACA,aAAa,2RAEN;AACP,KAAK;AACL;AACA,aAAa,iSAEN;AACP,KAAK;AACL;AACA,aAAa,yTAEN;AACP,KAAK;AACL;AACA,aAAa,uSAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC5HA;AAAA;AAAA;AAAA;AAAqrB,CAAgB,oqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;AC0MzsB;AAIA;AAGA;AAAA;AAAA,eACA;EACAC;IACA;MACAC;MACAC;MACA;MACAC;MACA;MACAC;MACAC;QACAC;MACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACA;IACA;EACA;;EACAC;IACAC;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;IACA;EAAA,GACA;IACAC;IACAC;EACA,GACA;EACAC;IACA;IACA;IACA;IACA;IACA;EACA;EACAC;IAAA;IACA;MACA;MACAC;QACA;UACA;QACA;MACA;MACAA;QACA;UACA;YACAC;UACA;QACA;MACA;IACA;EACA;EACAC;IACAC;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;IACA;IACAC;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MAAA;MACAC;MACA;QACAC;UACAC;UACAC;QACA;QACA;MACA;MACA;QACA;MACA;MACA;MACA;MACAZ;QAAA;UAAA;UAAA;YAAA;cAAA;gBAAA;kBAAA,MACAa;oBAAA;oBAAA;kBAAA;kBACAb;oBACA;sBACA;wBACAc;sBACA;oBACA;kBACA;oBACAL;kBACA;kBACA;kBAAA;kBAAA,OACAT;oBACAe;kBACA;gBAAA;kBAFAC;kBAGA;oBACA;oBACAN,mDACAM;sBACAC;wBACA;0BACAP;4BACAQ;0BACA;wBACA;sBACA;oBAAA,GACA;kBACA;oBACA;kBACA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CAEA;QAAA;UAAA;QAAA;MAAA;IACA;IACAC;MAAA;MAAA;MACAT;QACAC;QACAC;MACA;MACAQ;QACA;QACA;UACAV;YACAQ;UACA;QACA;MACA;IACA;IACAG;MACA;QACAC;MACA;MACA;QACAC;QACAA;QACAA;QACAA;QACAA;QACAA;MACA;MACAA;MACAA;MACAd;MACAc;MACA;IACA;IACAC;MAAA;MACA;MACAxB;QACA;UACA,gBAKAa;YAJAS;YACAlD;YACAU;YACAR;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;YACA;UACA;UAEAmC;UACA;UACA;UACA;QACA;MACA;QACAA;QACAC;UACAC;UACAC;UACAa;QACA;MACA;IACA;EACA;AACA;AAAA,2B","file":"pages/my/confirm_order/confirm_order.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/my/confirm_order/confirm_order.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./confirm_order.vue?vue&type=template&id=cdf7d236&\"\nvar renderjs\nimport script from \"./confirm_order.vue?vue&type=script&lang=js&\"\nexport * from \"./confirm_order.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/my/confirm_order/confirm_order.vue\"\nexport default component.exports","export * from \"-!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./confirm_order.vue?vue&type=template&id=cdf7d236&\"","var components\ntry {\n  components = {\n    uLoadingPage: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-loading-page/u-loading-page\" */ \"@/uni_modules/uview-ui/components/u-loading-page/u-loading-page.vue\"\n      )\n    },\n    uniTag: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-tag/components/uni-tag/uni-tag\" */ \"@/uni_modules/uni-tag/components/uni-tag/uni-tag.vue\"\n      )\n    },\n    \"u-Text\": function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u--text/u--text\" */ \"@/uni_modules/uview-ui/components/u--text/u--text.vue\"\n      )\n    },\n    uIcon: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-icon/u-icon\" */ \"@/uni_modules/uview-ui/components/u-icon/u-icon.vue\"\n      )\n    },\n    uCellGroup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-cell-group/u-cell-group\" */ \"@/uni_modules/uview-ui/components/u-cell-group/u-cell-group.vue\"\n      )\n    },\n    uCell: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-cell/u-cell\" */ \"@/uni_modules/uview-ui/components/u-cell/u-cell.vue\"\n      )\n    },\n    uSwitch: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-switch/u-switch\" */ \"@/uni_modules/uview-ui/components/u-switch/u-switch.vue\"\n      )\n    },\n    uButton: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-button/u-button\" */ \"@/uni_modules/uview-ui/components/u-button/u-button.vue\"\n      )\n    },\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniSegmentedControl: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control\" */ \"@/uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.vue\"\n      )\n    },\n    uniCollapse: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-collapse/components/uni-collapse/uni-collapse\" */ \"@/uni_modules/uni-collapse/components/uni-collapse/uni-collapse.vue\"\n      )\n    },\n    uLine: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-line/u-line\" */ \"@/uni_modules/uview-ui/components/u-line/u-line.vue\"\n      )\n    },\n    uniCollapseItem: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item\" */ \"@/uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.vue\"\n      )\n    },\n    uEmpty: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uview-ui/components/u-empty/u-empty\" */ \"@/uni_modules/uview-ui/components/u-empty/u-empty.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.loaded && !_vm.coupon.used.id ? _vm.coupon.available.length : null\n  var g1 =\n    _vm.loaded && !_vm.coupon.used.id && g0 > 0\n      ? _vm.coupon.available.length\n      : null\n  var a0 = _vm.loaded\n    ? {\n        \"border-radius\": \"999px\",\n        width: \"160rpx\",\n      }\n    : null\n  var g2 = _vm.coupon.available.length\n  var g3 = _vm.coupon.unavailable.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        a0: a0,\n        g2: g2,\n        g3: g3,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./confirm_order.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../softwore/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./confirm_order.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<u-loading-page :loading=\"!loaded\" loading-text=\"My Hastens\" loading-mode=\"semicircle\"></u-loading-page>\r\n\t\t<view v-if=\"loaded\">\r\n\t\t\t<view v-if=\"address_current_id > 0\" @click=\"$globalJump2View('/pages/my/address/address?change=1', true)\"\r\n\t\t\t\tclass=\"margin-top-sm container padding-tb-sm padding-lr bg-white margin-bottom-sm flex align-center\"\r\n\t\t\t\tstyle=\"border-radius: 12rpx;\">\r\n\t\t\t\t<view style=\"flex: 1;\">\r\n\t\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t\t<uni-tag v-if=\"address_current.is_default == 1\" text=\"默认\" size=\"mini\"\r\n\t\t\t\t\t\t\tcustom-style=\"background-color: #f43f5e; border-color: #f43f5e; color: #fff;margin-right: 6rpx;\"></uni-tag>\r\n\t\t\t\t\t\t<view class=\"text-sm\">\r\n\t\t\t\t\t\t\t{{address_current.province}}{{address_current.city != '县' && address_current.city != '市' ? address_current.city : ''}}{{address_current.area}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"text-bold\" style=\"margin: 6rpx 0;\">{{address_current.address}}</view>\r\n\t\t\t\t\t<view class=\"flex align-center justify-start\"><text>{{address_current.name}}</text>\r\n\t\t\t\t\t\t<view><u--text mode=\"phone\" :text=\"address_current.phone\" format=\"encrypt\" size=\"28rpx\"\r\n\t\t\t\t\t\t\t\tmargin=\"0 0 0 6rpx\"></u--text></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view style=\"margin-left: auto;\">\r\n\t\t\t\t\t<u-icon name=\"arrow-right\" color=\"#808080\" size=\"28rpx\"></u-icon>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-else @click=\"$globalJump2View('/pages/my/address/address?change=1', true)\"\r\n\t\t\t\tclass=\"margin-top-sm container padding-tb-sm padding-lr bg-white margin-bottom-sm flex align-center\"\r\n\t\t\t\tstyle=\"border-radius: 12rpx;\">\r\n\t\t\t\t<view style=\"flex: 1;\">\r\n\t\t\t\t\t<view class=\"text-bold\">您还未添加收货地址，立即添加</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view style=\"margin-left: auto;\">\r\n\t\t\t\t\t<u-icon name=\"arrow-right\" color=\"#b2b2b2\" size=\"28rpx\"></u-icon>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 结算的产品 -->\r\n\t\t\t<view class=\"bg-white container padding margin-bottom-sm\" style=\"border-radius: 12rpx;\">\r\n\t\t\t\t<view class=\"flex\" v-for=\"(item,index) in goods_list\" :key=\"item.id\">\r\n\t\t\t\t\t<image style=\"width: 200rpx;height: 200rpx;border-radius: 20rpx;\" mode=\"aspectFill\"\r\n\t\t\t\t\t\t:src='item.goods_cover'></image>\r\n\t\t\t\t\t<view class=\"margin-left\" style=\"width: 470rpx;\">\r\n\t\t\t\t\t\t<view class=\"text-lg\">{{item.goods_name}}</view>\r\n\t\t\t\t\t\t<view class=\"text-desc text-sm\">{{item.goods_spec_alias}}</view>\r\n\t\t\t\t\t\t<view class=\"margin-top\">\r\n\t\t\t\t\t\t\t<text class=\"text-xs\">￥<text class=\"text-lg\">{{item.price_selling}}</text></text>\r\n\t\t\t\t\t\t\t<text style=\"margin-left: 6rpx;\"> x {{item.stock_sales}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"bg-white container padding-xs margin-bottom-sm\" style=\"border-radius: 12rpx;\">\r\n\t\t\t\t<u-cell-group :border=\"false\">\r\n\t\t\t\t\t<u-cell title=\"商品总额\" :border=\"false\" :value=\"'￥'+total.amount_goods\"></u-cell>\r\n\t\t\t\t\t<u-cell :border=\"false\" title=\"运费\" :value=\"'￥' + total.express_amount \" />\r\n\t\t\t\t\t<u-cell :border=\"false\" title=\"优惠券\">\r\n\t\t\t\t\t\t<template slot=\"value\">\r\n\t\t\t\t\t\t\t<view v-if=\"coupon.used.id\" class=\"text-df\" style=\"line-height: 24px;\">\r\n\t\t\t\t\t\t\t\t<text>「{{coupon.used.label}}」 -￥{{total.discount_amount}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view v-else class=\"text-df\" style=\"line-height: 24px;\"\r\n\t\t\t\t\t\t\t\t@click.native.stop=\"openCouponPopup\">\r\n\t\t\t\t\t\t\t\t<text class=\"text-red\"\r\n\t\t\t\t\t\t\t\t\tv-if=\"coupon.available.length>0\">{{coupon.available.length}}个可用</text>\r\n\t\t\t\t\t\t\t\t<text class=\"text-gray\" v-else>无可用</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t<template slot=\"right-icon\">\r\n\t\t\t\t\t\t\t<view v-if=\"coupon.used.id\" class=\"text-df\" @click.native.stop=\"onNotUseCoupon\">\r\n\t\t\t\t\t\t\t\t<u-icon name=\"close-circle\"></u-icon>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view v-else class=\"text-df\" @click.native.stop=\"openCouponPopup\">\r\n\t\t\t\t\t\t\t\t<u-icon name=\"arrow-right\"></u-icon>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</u-cell>\r\n\t\t\t\t\t<u-cell :border=\"false\" center v-if=\"use_available && integral_available > 0\">\r\n\t\t\t\t\t\t<view slot=\"title\" class=\"u-slot-title\">\r\n\t\t\t\t\t\t\t<text class=\"u-cell-text\">积分抵扣</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<u-switch slot=\"right-icon\" size=\"18\" v-model=\"switchChecked\" @change=\"onSwitchChange\"\r\n\t\t\t\t\t\t\tactiveColor=\"#0B1839\"></u-switch>\r\n\t\t\t\t\t\t<view slot=\"value\" class=\"text-df\" style=\"color: #606266;line-height: 48rpx;\">\r\n\t\t\t\t\t\t\t-￥{{total.amount_integral}}</view>\r\n\t\t\t\t\t\t<view slot=\"label\" class=\"text-xs\" style=\"color: #808080;\">\r\n\t\t\t\t\t\t\t{{integral_available}}积分可用{{total.integral_num > 0 ? '(-'+total.integral_num+'积分)':''}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</u-cell>\r\n\t\t\t\t\t<view style=\"text-align: right;padding: 20rpx 30rpx;\">合计：<text\r\n\t\t\t\t\t\t\tclass=\"text-red\">￥{{total.amount_real}}</text></view>\r\n\t\t\t\t</u-cell-group>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"bg-white\"\r\n\t\t\t\tstyle=\"position: fixed;width: 100%;left: 0;bottom: 0;padding-bottom: env(safe-area-inset-bottom);z-index: 9;\">\r\n\t\t\t\t<view class=\"flex align-center justify-center\" style=\"padding: 0 32rpx;\">\r\n\t\t\t\t\t<view class=\"flex justify-end\" style=\"flex: 1;text-align: right;\">\r\n\t\t\t\t\t\t<!-- <view>合计：</view> -->\r\n\t\t\t\t\t\t<view class=\"text-red\">￥<text\r\n\t\t\t\t\t\t\t\tclass=\"text-xl text-bold\">{{total_order_amount}}</text>.{{total_order_amount_ceil}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view style=\"padding: 10rpx;\">\r\n\t\t\t\t\t\t<view style=\"border: none;display: inline-block;\">\r\n\t\t\t\t\t\t\t<u-button :disabled=\"address_current_id === 0\" type=\"primary\" text=\"付款\" color=\"#000\"\r\n\t\t\t\t\t\t\t\t:custom-style=\"{'border-radius':'999px','width':'160rpx'}\"\r\n\t\t\t\t\t\t\t\tstyle=\"width: 160rpx;border-radius: 999px;\" @click.native=\"pay\"></u-button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<uni-popup ref=\"coupon_ref\" type=\"bottom\" background-color=\"#f8f8f8\">\r\n\t\t\t<view>\r\n\t\t\t\t<view class=\"padding\">\r\n\t\t\t\t\t<uni-segmented-control :current=\"current\" :values=\"couponTabsLabel\" @clickItem=\"onClickItem\"\r\n\t\t\t\t\t\tstyleType=\"button\" activeColor=\"#000030\"></uni-segmented-control>\r\n\t\t\t\t</view>\r\n\t\t\t\t<scroll-view scroll-y style=\"height: 700rpx;\">\r\n\t\t\t\t\t<view class=\"padding-lr padding-bottom\">\r\n\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t<view v-show=\"current === 0\">\r\n\t\t\t\t\t\t\t\t<uni-collapse v-model=\"coupon_available_opens\" style=\"background-color: transparent;\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"container bg-white padding-lr padding-tb-sm margin-tp\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"border-radius: 12rpx;\" v-for=\"(item,index) in coupon.available\"\r\n\t\t\t\t\t\t\t\t\t\t:key=\"item.id\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"margin-tb-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center text-lg\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text>{{item.title}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-red\">可折扣￥{{item.discount_amount}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center margin-tb-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text>有效期至{{item.end_time_format}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-red\">{{item.label}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<u-line dashed></u-line>\r\n\t\t\t\t\t\t\t\t\t\t<uni-collapse-item :name=\"'available_'+index\" titleBorder=\"none\" :border=\"false\"\r\n\t\t\t\t\t\t\t\t\t\t\t:show-arrow=\"false\">\r\n\t\t\t\t\t\t\t\t\t\t\t<template v-slot:title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center margin-top-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-xs\">使用规则</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"margin-left-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<u-icon name=\"arrow-down-fill\" size=\"10rpx\"></u-icon>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view><u-button type=\"primary\" shape=\"circle\" plain text=\"立即使用\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@click.native.stop=\"onCouponUse(item.id)\"></u-button></view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t</template>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"text-xs\">{{item.remark}}</view>\r\n\t\t\t\t\t\t\t\t\t\t</uni-collapse-item>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</uni-collapse>\r\n\t\t\t\t\t\t\t\t<u-empty v-if=\"coupon.available.length === 0\" marginTop=\"44\" text=\"暂无可用优惠券\"\r\n\t\t\t\t\t\t\t\t\ticon=\"/static/empty_data.png\"></u-empty>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view v-show=\"current === 1\">\r\n\t\t\t\t\t\t\t\t<uni-collapse v-model=\"coupon_unavailable_opens\" style=\"background-color: transparent;\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"container bg-white padding-lr padding-tb-sm margin-tp\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"border-radius: 12rpx;\" v-for=\"(item,index) in coupon.unavailable\"\r\n\t\t\t\t\t\t\t\t\t\t:key=\"item.id\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"margin-tb-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center text-lg\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text>{{item.title}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-gray\">暂不可用</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center margin-tb-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text>有效期至{{item.end_time_format}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-red\">{{item.label}}</text>\r\n\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<u-line dashed></u-line>\r\n\t\t\t\t\t\t\t\t\t\t<uni-collapse-item :name=\"'unavailable_'+index\" titleBorder=\"none\"\r\n\t\t\t\t\t\t\t\t\t\t\t:border=\"false\" :show-arrow=\"false\">\r\n\t\t\t\t\t\t\t\t\t\t\t<template v-slot:title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex justify-between align-center margin-top-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"flex align-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<text class=\"text-xs\">使用规则</text>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<view class=\"margin-left-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<u-icon name=\"arrow-down-fill\" size=\"10rpx\"></u-icon>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t\t</template>\r\n\t\t\t\t\t\t\t\t\t\t\t<view class=\"text-xs\">{{item.remark}}</view>\r\n\t\t\t\t\t\t\t\t\t\t</uni-collapse-item>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</uni-collapse>\r\n\t\t\t\t\t\t\t\t<u-empty v-if=\"coupon.unavailable.length === 0\" marginTop=\"44\" text=\"暂无不可用优惠券\"\r\n\t\t\t\t\t\t\t\t\ticon=\"/static/empty_data.png\"></u-empty>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</view>\r\n\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\taxios,\r\n\t\tcheckLogin\r\n\t} from '@/utils/request'\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapGetters\r\n\t} from 'vuex'\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tfrom_cart: '0',\r\n\t\t\t\tcurrent: 0,\r\n\t\t\t\t// 购物车传过来的数据\r\n\t\t\t\tans_list: '',\r\n\t\t\t\t// 结算的产品\r\n\t\t\t\tgoods_list: [],\r\n\t\t\t\texpress: {\r\n\t\t\t\t\tamount: '0.00'\r\n\t\t\t\t},\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount_goods: '0.00',\r\n\t\t\t\t\tamount_integral: '0.00',\r\n\t\t\t\t\texpress_amount: '0.00',\r\n\t\t\t\t\tdiscount_amount: '0.00',\r\n\t\t\t\t\tamount_real: '0.00'\r\n\t\t\t\t},\r\n\t\t\t\torderLoading: false,\r\n\t\t\t\tloaded: false,\r\n\t\t\t\tcoupon: {\r\n\t\t\t\t\tavailable: [],\r\n\t\t\t\t\tunavailable: [],\r\n\t\t\t\t\tused: {}\r\n\t\t\t\t},\r\n\t\t\t\tcoupon_id: '',\r\n\t\t\t\tswitchChecked: false,\r\n\t\t\t\tintegral_available: 0,\r\n\t\t\t\tuse_available: false,\r\n\t\t\t\tcoupon_available_opens: [],\r\n\t\t\t\tcoupon_unavailable_opens: [],\r\n\t\t\t\t// couponTabsLabel: ['可用（0）', '不可用（0）']\r\n\t\t\t};\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\ttotal_order_amount() {\r\n\t\t\t\treturn parseInt(this.total.amount_real || 0);\r\n\t\t\t},\r\n\t\t\ttotal_order_amount_ceil() {\r\n\t\t\t\tlet str = this.total.amount_real || '0.00'\r\n\t\t\t\treturn str.substring(str.indexOf(\".\") + 1, str.indexOf(\".\") + 3);\r\n\t\t\t},\r\n\t\t\tcouponTabsLabel() {\r\n\t\t\t\treturn ['可用(' + this.coupon.available.length + ')', '不可用(' + this.coupon.unavailable.length + ')']\r\n\t\t\t},\r\n\t\t\t...mapGetters({\r\n\t\t\t\taddress_current: 'user_address/address_current',\r\n\t\t\t\taddress_current_id: 'user_address/address_current_id'\r\n\t\t\t})\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\tthis.ans_list = options.key\r\n\t\t\tthis.switchChecked = options.use_integral == '1' ? true : false\r\n\t\t\tthis.from_cart = options.from_cart === '1' ? '1' : '0'\r\n\t\t\t// console.log(this.address_current)\r\n\t\t\t// console.log(this.address_current_id)\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tcheckLogin(() => {\r\n\t\t\t\tthis.loadData()\r\n\t\t\t\taxios.get('/api/v1/user/info').then(res => {\r\n\t\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\t\tthis.integral_available = res.data.integral_available\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\taxios.get('/api/v1/user/address').then(res => {\r\n\t\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\t\tthis.$store.commit('user_address/update_user_address_list', {\r\n\t\t\t\t\t\t\taddress_list: res.data.list\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\topenCouponPopup() {\r\n\t\t\t\tthis.$refs.coupon_ref.open()\r\n\t\t\t},\r\n\t\t\tonNotUseCoupon() {\r\n\t\t\t\tthis.coupon_id = '-1'\r\n\t\t\t\tthis.loadData()\r\n\t\t\t},\r\n\t\t\tonCouponUse(id) {\r\n\t\t\t\tthis.coupon_id = id\r\n\t\t\t\tthis.$refs.coupon_ref.close()\r\n\t\t\t\tthis.loadData()\r\n\t\t\t},\r\n\t\t\tonClickItem(e) {\r\n\t\t\t\tif (this.current != e.currentIndex) {\r\n\t\t\t\t\tthis.current = e.currentIndex;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tonSwitchChange(e) {\r\n\t\t\t\tthis.switchChecked = e\r\n\t\t\t\tthis.loadData()\r\n\t\t\t},\r\n\t\t\t// 创建订单+支付接口\r\n\t\t\tpay() {\r\n\t\t\t\tconsole.log('创建订单')\r\n\t\t\t\tif (!this.address_current_id) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请选择收货地址',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tif (this.orderLoading !== false) {\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t\tthis.orderLoading = true\r\n\t\t\t\tlet params = this.createParams()\r\n\t\t\t\taxios.post('/api/v1/user/order/create', params).then(async (res) => {\r\n\t\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\t\taxios.get('/api/v1/user/goods/cart_num').then(res => {\r\n\t\t\t\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\t\t\t\tthis.$store.dispatch('goods_cart/update_goods_cart_number_badge', {\r\n\t\t\t\t\t\t\t\t\tnumber: res.data\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\t\tconsole.log(err)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t// 下单成功 获取订单支付参数\r\n\t\t\t\t\t\tconst paymentRes = await axios.post('/api/v1/user/order/payment', {\r\n\t\t\t\t\t\t\torder_no: res.data.order_no\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif (paymentRes.code === 1) {\r\n\t\t\t\t\t\t\tthis.orderLoading = false\r\n\t\t\t\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\t\t\t\t...paymentRes.data.param,\r\n\t\t\t\t\t\t\t\tsuccess: (red) => {\r\n\t\t\t\t\t\t\t\t\tif (red.errMsg == \"requestPayment:ok\") {\r\n\t\t\t\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\t\t\t\turl: '/pages/my/my_order/my_order',\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.resetPay(paymentRes.info, true)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tresetPay(msg, golist = false) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: msg,\r\n\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.orderLoading = false\r\n\t\t\t\t\tif (golist) {\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl: '/pages/my/my_order/my_order',\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 1500)\r\n\t\t\t},\r\n\t\t\tcreateParams() {\r\n\t\t\t\tlet params = {\r\n\t\t\t\t\titems: this.ans_list,\r\n\t\t\t\t}\r\n\t\t\t\tif (this.address_current_id > 0) {\r\n\t\t\t\t\tparams.address_name = this.address_current.name\r\n\t\t\t\t\tparams.address_phone = this.address_current.phone\r\n\t\t\t\t\tparams.address_province = this.address_current.province\r\n\t\t\t\t\tparams.address_city = this.address_current.city\r\n\t\t\t\t\tparams.address_area = this.address_current.area\r\n\t\t\t\t\tparams.address_content = this.address_current.address\r\n\t\t\t\t}\r\n\t\t\t\tparams.coupon_id = this.coupon_id\r\n\t\t\t\tparams.integral = this.switchChecked ? '1' : '0'\r\n\t\t\t\tconsole.log(params)\r\n\t\t\t\tparams.from_cart = this.from_cart\r\n\t\t\t\treturn params\r\n\t\t\t},\r\n\t\t\tloadData() {\r\n\t\t\t\tlet params = this.createParams()\r\n\t\t\t\taxios.post(\"/api/v1/user/order/confirm\", params).then(res => {\r\n\t\t\t\t\tif (res.code === 1) {\r\n\t\t\t\t\t\tlet {\r\n\t\t\t\t\t\t\titems,\r\n\t\t\t\t\t\t\texpress,\r\n\t\t\t\t\t\t\tcoupon,\r\n\t\t\t\t\t\t\ttotal\r\n\t\t\t\t\t\t} = res.data\r\n\t\t\t\t\t\tthis.total = Object.assign({}, this.total, total)\r\n\t\t\t\t\t\tthis.goods_list = items\r\n\t\t\t\t\t\tthis.coupon = coupon\r\n\t\t\t\t\t\t// this.couponTabsLabel[0] = '可用（' + coupon.available.length + '）'\r\n\t\t\t\t\t\t// this.couponTabsLabel[1] = '不可用（' + coupon.unavailable.length + '）'\r\n\t\t\t\t\t\tthis.loaded = true\r\n\t\t\t\t\t\tif (res.data.items.length === 1 && res.data.items[0].integral_limit !== '0.00') {\r\n\t\t\t\t\t\t\tthis.use_available = true\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconsole.log(this.coupon)\r\n\t\t\t\t\t\t// setTimeout(() => {\r\n\t\t\t\t\t\t// \tthis.$refs.coupon_ref.open()\r\n\t\t\t\t\t\t// }, 1500)\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(error => {\r\n\t\t\t\t\tconsole.log(error)\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '出错了，请稍后重试！',\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tduration: 1200\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\r\n</style>"],"sourceRoot":""}