(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/goods_detail/goods_detail"],{"475e":function(e,t,o){"use strict";(function(e,t){var n=o("4ea4");o("be30");n(o("66fd"));var c=n(o("c6a4"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(c.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"4b73":function(e,t,o){"use strict";(function(e){var n=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=n(o("448a")),r=n(o("9523")),i=o("26cb"),s=o("db75");function a(e,t){var o="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"===typeof e)return u(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u(e,t)}(e))||t&&e&&"number"===typeof e.length){o&&(e=o);var n=0,c=function(){};return{s:c,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){s=!0,r=e},f:function(){try{i||null==o.return||o.return()}finally{if(s)throw r}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){(0,r.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var f={data:function(){return{loaded:!1,detail:{},checkspec:{},showSpecFlag:!1,Num:1,checkSpecArr:[]}},computed:d(d({},(0,i.mapState)({goods_cart_number:function(e){return e.goods_cart.goods_cart_number},userinfo:function(e){return e.user.userinfo}})),{},{maxNum:function(){return this.checkspec.id?this.checkspec.stock_total-this.checkspec.stock_sales:1}}),onLoad:function(t){console.log(t),t.uid&&e.setStorageSync("pid",t.uid),this.aid=t.id,this.loadData(t.id)},onShareAppMessage:function(e){var t="pages/shop/goods_detail/goods_detail?id="+this.aid+"&uid="+this.userinfo.id;return console.log(t),{title:this.detail.name,path:t,imageUrl:this.detail.cover}},methods:{showPreviewImage:function(t){e.previewImage({current:t,urls:this.detail.slider,indicator:"number"})},onSpecPopupChange:function(e){this.showSpecFlag=e.show},showSpecModal:function(t){var o=t.currentTarget.dataset.index;if(!1===this.showSpecFlag)return this.$refs.spec_popup.open(),!1;this.checkspec.id?1==o?this.addCart():2==o&&this.goToBuycreate():e.showToast({title:"请选择商品规格",icon:"none"})},addCart:function(){var t=this;console.log("加入购物车"),(0,s.checkLogin)((function(){s.axios.post("/api/v1/user/goods/cart/add",{goods_id:t.aid,goods_spec:t.checkspec.goods_spec,goods_number:t.Num,goods_title:t.detail.name,goods_cover:t.detail.cover}).then((function(o){t.$refs.spec_popup.close(),1===o.code?(t.$store.commit("goods_cart/update_goods_cart_number",{number:o.data}),e.showToast({title:o.info,icon:"none"})):e.showToast({title:"操作失败",icon:"none"})})).catch((function(t){console.log(t),e.showToast({title:"操作失败",icon:"none"})}))}))},goToBuycreate:function(){var t=this;console.log("直接购买"),(0,s.checkLogin)((function(){if(t.checkspec.stock_total>t.checkspec.stock_sales){var o=t.detail.available_integral?1:0;e.navigateTo({url:"/pages/my/confirm_order/confirm_order?use_integral="+o+"&key="+t.aid+"@"+t.checkspec.goods_spec+"@"+t.Num})}else e.showToast({title:"库存不足",icon:"none"})}))},goods_spec_alias:function(e){var t=[];return e.goods_spec.split(";;").map((function(e){t.push(e.split("::")[1])})),e.goods_spec_alias=t.join(" "),e},checkIsElective:function(e){var t=!1;return this.detail.items.forEach((function(o,n){var c=";;"+o.goods_spec+";;";c.indexOf(";;"+e+";;")>-1&&o.stock_total>o.stock_sales&&(t=!0)})),t},loadData:function(e){var t=this;s.axios.get("/api/v1/goods/"+e).then((function(e){if(console.log(e),1===e.code){t.loaded=!0,t.detail=e.data;var o=(0,c.default)(e.data.specs);o.forEach((function(e,o){t.checkSpecArr[o]="",e.list.forEach((function(o,n){o=Object.assign(o,{is_seleted:!1,is_elective:t.checkIsElective(e.name+"::"+o.name)})}))})),console.log(o),console.log(t.checkSpecArr)}}))},gotoShopCart:function(){e.navigateTo({url:"/pages/shop_cart/shop_cart"})},onNumChange:function(e){console.log("当前值为: "+e.value)},setSpecSeleted:function(e){this.specChanged(e.currentTarget.dataset.key1,e.currentTarget.dataset.key2)},checkIsElectiveFromSpecArr:function(e){var t,o=!1,n=a(this.detail.items);try{for(n.s();!(t=n.n()).done;){var c,r=t.value,i=";;"+r.goods_spec+";;",s=!0,u=a(e);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(-1===i.indexOf(l)){s=!1;break}}}catch(d){u.e(d)}finally{u.f()}if(!1!==s&&r.stock_total>r.stock_sales){o=!0;break}}}catch(d){n.e(d)}finally{n.f()}return o},specChanged:function(e,t){var o=this,n=this.detail.specs,r=n[e].list[t];if(!1===r.is_elective)return!1;console.log(r),r.is_seleted=!r.is_seleted,!0===r.is_seleted?this.checkSpecArr[e]=r.group+"::"+r.name:this.checkSpecArr[e]="",console.log(this.checkSpecArr),n[e].list.forEach((function(e,o){o!==t&&(e.is_seleted=!1)})),n.forEach((function(t,n){n===e&&!1!==r.is_seleted||t.list.forEach((function(e,t){if(!1===e.is_seleted){var c=[";;"+e.group+"::"+e.name+";;"];o.checkSpecArr.forEach((function(e,t){""!==e&&t!==n&&c.push(";;"+e+";;")})),console.log("specArr",c),e.is_elective=o.checkIsElectiveFromSpecArr(c)}}))})),console.log(n),n[e].list[t]=r,this.detail.specs=(0,c.default)(n);var i,s=!0,u=a(this.checkSpecArr);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(""===l){s=!1;break}}}catch(d){u.e(d)}finally{u.f()}s?this.detail.items.forEach((function(e,t){var n=!0;o.checkSpecArr.forEach((function(t,o){var c=";;"+e.goods_spec+";;";-1===c.indexOf(";;"+t+";;")&&(n=!1)})),!0===n&&(e=o.goods_spec_alias(e),o.checkspec=e)})):this.checkspec={},console.log(this.detail),console.log(this.checkspec),this.Num=1}}};t.default=f}).call(this,o("543d")["default"])},"6ec1":function(e,t,o){"use strict";o.r(t);var n=o("4b73"),c=o.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=c.a},c6a4:function(e,t,o){"use strict";o.r(t);var n=o("c944"),c=o("6ec1");for(var r in c)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return c[e]}))}(r);o("e0c6");var i=o("f0c5"),s=Object(i["a"])(c["default"],n["b"],n["c"],!1,null,"4e7268a9",null,!1,n["a"],void 0);t["default"]=s.exports},c944:function(e,t,o){"use strict";o.d(t,"b",(function(){return c})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return n}));var n={uToast:function(){return o.e("uni_modules/uview-ui/components/u-toast/u-toast").then(o.bind(null,"8518"))},uLoadingPage:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(o.bind(null,"8282"))},uIcon:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(o.bind(null,"4a55"))},uBadge:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-badge/u-badge")]).then(o.bind(null,"3798"))},uButton:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-button/u-button")]).then(o.bind(null,"4005"))},uniPopup:function(){return o.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(o.bind(null,"31f2"))},uImage:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-image/u-image")]).then(o.bind(null,"fcd4"))},uNumberBox:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-number-box/u-number-box")]).then(o.bind(null,"2f61"))}},c=function(){var e=this,t=e.$createElement,o=(e._self._c,e.detail.specs&&e.detail.specs.length>0),n=o?e.detail.specs.length:null,c=e.__map(e.detail.specs,(function(t,o){var n=e.__get_orig(t),c=e.detail.specs&&e.detail.specs.length>0||t.list.length>1;return{$orig:n,g2:c}}));e.$mp.data=Object.assign({},{$root:{a0:{"border-radius":"999px 0 0 999px"},a1:{"border-radius":"0 999px 999px 0"},g0:o,g1:n,l0:c}})},r=[]},e0c6:function(e,t,o){"use strict";var n=o("e99b"),c=o.n(n);c.a},e99b:function(e,t,o){}},[["475e","common/runtime","common/vendor"]]]);