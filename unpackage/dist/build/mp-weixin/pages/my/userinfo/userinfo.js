(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/userinfo/userinfo"],{"09c4":function(e,n,t){"use strict";(function(e,n){var i=t("4ea4");t("be30");i(t("66fd"));var o=i(t("3549"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},3549:function(e,n,t){"use strict";t.r(n);var i=t("c1fe"),o=t("a7ab");for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t("d39f");var r=t("f0c5"),s=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"9995aaa6",null,!1,i["a"],void 0);n["default"]=s.exports},"3a22":function(e,n,t){"use strict";(function(e){var i=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(t("2eee")),a=i(t("c973")),r=i(t("448a")),s=i(t("9523")),u=t("26cb"),c=t("db75");function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){(0,s.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var f={data:function(){return{loaded:!1,nickname:"",base_sex:"男",base_birthday:"",regions:[],multiIndex:[0,0,0],multiIds:[],newArr:[],defaultAvatarUrl:"https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0"}},computed:d(d({},(0,u.mapState)({userinfo:function(e){return e.user.userinfo}})),(0,u.mapGetters)({is_login:"user/is_login"})),onLoad:function(){var e=this;(0,c.checkLogin)((function(){e.loadRegions()}))},onShow:function(){this.nickname=this.userinfo.nickname,this.base_sex=this.userinfo.base_sex,this.base_birthday=this.userinfo.base_birthday},methods:{bindMutilPickerChange:function(e){var n=this;this.regions.map((function(e,t){n.multiIndex[0]===t&&(n.multiIds[0]=d({},e),e.subs.map((function(e,t){n.multiIndex[1]===t&&(n.multiIds[1]=d({},e),e.subs.map((function(e,t){n.multiIndex[2]===t&&(n.multiIds[2]=d({},e))})))})))})),console.log(this.multiIds),this.$forceUpdate()},bindMutilPickerColumnChange:function(e){var n=this,t={newArr:this.newArr,multiIndex:this.multiIndex};t.multiIndex[e.detail.column]=e.detail.value;var i=function(){var e=[],i=[];n.regions.map((function(n,o){t.multiIndex[0]===o&&n.subs.map((function(n,o){e.push(n.name),t.multiIndex[1]===o&&n.subs.map((function(e,n){i.push(e.name)}))}))})),t.newArr[1]=e,t.newArr[2]=i};switch(e.detail.column){case 0:t.multiIndex[1]=0,t.multiIndex[2]=0,i();break;case 1:t.multiIndex[2]=0,i();break;case 2:i();break}this.newArr=t.newArr,this.multiIndex=(0,r.default)(t.multiIndex),this.$forceUpdate()},buildRegions:function(e){this.regions=e;var n={arr:[],arr1:[],arr2:[],arr3:[]};e.map((function(e,t){n.arr1.push(e.name),n.arr2.length<=0&&e.subs.map((function(e,t){n.arr2.push(e.name),n.arr3.length<=0&&e.subs.map((function(e,t){n.arr3.push(e.name)}))}))})),n.arr[0]=n.arr1,n.arr[1]=n.arr2,n.arr[2]=n.arr3,this.newArr=n.arr},loadRegions:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var t,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c.axios.get("/api/v1/goods/region");case 3:if(t=n.sent,1===t.code){n.next=6;break}throw new Error("城市数据获取失败");case 6:e.buildRegions(t.data),e.nickname=e.userinfo.nickname,e.base_sex=e.userinfo.base_sex,e.base_birthday=e.userinfo.base_birthday,""!==e.userinfo.region_province&&(i={multiIndex:(0,r.default)(e.multiIndex),multiIds:(0,r.default)(e.multiIds),arr2:[],arr3:[]},e.regions.map((function(n,t){n.name===e.userinfo.region_province&&(i.multiIndex[0]=t,i.multiIds[0]=d({},n),n.subs.map((function(n,t){i.arr2.push(n.name),n.name===e.userinfo.region_city&&(i.multiIndex[1]=t,i.multiIds[1]=d({},n),n.subs.map((function(n,t){i.arr3.push(n.name),n.name===e.userinfo.region_area&&(i.multiIndex[2]=t,i.multiIds[2]=d({},n))})))})))})),3===i.multiIds.length&&(e.multiIndex=i.multiIndex,e.multiIds=i.multiIds,e.newArr[1]=i.arr2,e.newArr[2]=i.arr3,e.$forceUpdate())),e.loaded=!0,n.next=17;break;case 14:n.prev=14,n.t0=n["catch"](0),console.log(n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))()},onSexClick:function(e){this.base_sex=e},onChangeNickname:function(e){console.log("onChangeNickname",e),this.nickname=e.detail.value},bindBirthdayChange:function(e){this.base_birthday=e.detail.value},onChooseAvatar:function(){var n=this;console.log("上传图片"),e.chooseImage({count:1,sizeType:["compressed"],success:function(t){console.log(t),e.showLoading({title:"上传中~",mask:!0}),e.uploadFile({url:c.base_url+"/api/v1/user/info/set_portrait",fileType:"image",filePath:t.tempFilePaths[0],name:"file",formData:{token:n.$store.state.user.token},success:function(t){e.hideLoading(),console.log(t);var i=JSON.parse(t.data);1===i.code?(n.$store.commit("user/update_user_headimg",{headimg:i.data.url}),e.showToast({title:i.info,icon:"success"})):e.showToast({title:i.info,icon:"none"})},fail:function(n){e.hideLoading(),console.log(n),e.showToast({title:"出错了，请稍后再试！",icon:"none"})}})}})},onWexinChooseAvatar:function(n){var t=this;console.log("微信选择了图片",n);var i=n.detail.avatarUrl;e.uploadFile({url:c.base_url+"/api/v1/user/info/set_portrait",fileType:"image",filePath:i,name:"file",formData:{token:this.$store.state.user.token},success:function(n){console.log(n);var i=JSON.parse(n.data);1===i.code?(t.$store.commit("user/update_user_headimg",{headimg:i.data.url}),e.showToast({title:i.info,icon:"success"})):e.showToast({title:i.info,icon:"error"})},fail:function(n){e.showToast({title:"出错了，请稍后再试！",icon:"error"})}})},submit:function(){console.log("点击了保存信息按钮");var e={base_sex:this.base_sex,base_birthday:this.base_birthday,nickname:this.nickname};this.multiIds.length>2&&(e.region_province=this.multiIds[0].name,e.region_city=this.multiIds[1].name,e.region_area=this.multiIds[2].name),this.updateUserInfo(e)},updateUserInfo:function(n){var t=this;e.showLoading({title:"保存中~",mask:!0}),c.axios.post("/api/v1/user/info",n).then((function(i){e.hideLoading(),1===i.code?(t.$store.commit("user/update_user",Object.assign({},t.userinfo,n)),e.showToast({title:i.info,icon:"success",duration:1200})):e.showToast({title:i.info,icon:"none",duration:1200})})).catch((function(n){e.hideLoading(),e.showToast({title:"出错了~",icon:"none",duration:1200})}))}}};n.default=f}).call(this,t("543d")["default"])},4716:function(e,n,t){},a7ab:function(e,n,t){"use strict";t.r(n);var i=t("3a22"),o=t.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(a);n["default"]=o.a},c1fe:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return i}));var i={uLoadingPage:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(t.bind(null,"8282"))},uImage:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-image/u-image")]).then(t.bind(null,"fcd4"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"4005"))},uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"4a55"))}},o=function(){var e=this.$createElement,n=(this._self._c,this.loaded?this.multiIds.length:null);this.$mp.data=Object.assign({},{$root:{g0:n}})},a=[]},d39f:function(e,n,t){"use strict";var i=t("4716"),o=t.n(i);o.a}},[["09c4","common/runtime","common/vendor"]]]);