(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/confirm_order/confirm_order"],{"1af6":function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("be30");o(t("66fd"));var r=o(t("40fe"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"40fe":function(e,n,t){"use strict";t.r(n);var o=t("cf1f"),r=t("6aa5");for(var u in r)["default"].indexOf(u)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(u);var i=t("f0c5"),a=Object(i["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=a.exports},"6aa5":function(e,n,t){"use strict";t.r(n);var o=t("888c"),r=t.n(o);for(var u in o)["default"].indexOf(u)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(u);n["default"]=r.a},"888c":function(e,n,t){"use strict";(function(e){var o=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t("2eee")),u=o(t("c973")),i=o(t("9523")),a=t("db75"),s=t("26cb");function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){(0,i.default)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var d={data:function(){return{from_cart:"0",current:0,ans_list:"",goods_list:[],express:{amount:"0.00"},total:{amount_goods:"0.00",amount_integral:"0.00",express_amount:"0.00",discount_amount:"0.00",amount_real:"0.00"},orderLoading:!1,loaded:!1,coupon:{available:[],unavailable:[],used:{}},coupon_id:"",switchChecked:!1,integral_available:0,use_available:!1,coupon_available_opens:[],coupon_unavailable_opens:[]}},computed:l({total_order_amount:function(){return parseInt(this.total.amount_real||0)},total_order_amount_ceil:function(){var e=this.total.amount_real||"0.00";return e.substring(e.indexOf(".")+1,e.indexOf(".")+3)},couponTabsLabel:function(){return["可用("+this.coupon.available.length+")","不可用("+this.coupon.unavailable.length+")"]}},(0,s.mapGetters)({address_current:"user_address/address_current",address_current_id:"user_address/address_current_id"})),onLoad:function(e){this.ans_list=e.key,this.switchChecked="1"==e.use_integral,this.from_cart="1"===e.from_cart?"1":"0"},onShow:function(){var e=this;(0,a.checkLogin)((function(){e.loadData(),a.axios.get("/api/v1/user/info").then((function(n){1===n.code&&(e.integral_available=n.data.integral_available)})),a.axios.get("/api/v1/user/address").then((function(n){1===n.code&&e.$store.commit("user_address/update_user_address_list",{address_list:n.data.list})}))}))},methods:{openCouponPopup:function(){this.$refs.coupon_ref.open()},onNotUseCoupon:function(){this.coupon_id="-1",this.loadData()},onCouponUse:function(e){this.coupon_id=e,this.$refs.coupon_ref.close(),this.loadData()},onClickItem:function(e){this.current!=e.currentIndex&&(this.current=e.currentIndex)},onSwitchChange:function(e){this.switchChecked=e,this.loadData()},pay:function(){var n=this;if(console.log("创建订单"),!this.address_current_id)return e.showToast({title:"请选择收货地址",icon:"none"}),!1;if(!1!==this.orderLoading)return!1;this.orderLoading=!0;var t=this.createParams();a.axios.post("/api/v1/user/order/create",t).then(function(){var t=(0,u.default)(r.default.mark((function t(o){var u;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!==o.code){t.next=6;break}return a.axios.get("/api/v1/user/goods/cart_num").then((function(e){1===e.code&&n.$store.dispatch("goods_cart/update_goods_cart_number_badge",{number:e.data})})).catch((function(e){console.log(e)})),t.next=4,a.axios.post("/api/v1/user/order/payment",{order_no:o.data.order_no});case 4:u=t.sent,1===u.code?(n.orderLoading=!1,e.requestPayment(l(l({},u.data.param),{},{success:function(n){"requestPayment:ok"==n.errMsg&&e.navigateTo({url:"/pages/my/my_order/my_order"})}}))):n.resetPay(u.info,!0);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},resetPay:function(n){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.showToast({title:n,icon:"none"}),setTimeout((function(){t.orderLoading=!1,o&&e.navigateTo({url:"/pages/my/my_order/my_order"})}),1500)},createParams:function(){var e={items:this.ans_list};return this.address_current_id>0&&(e.address_name=this.address_current.name,e.address_phone=this.address_current.phone,e.address_province=this.address_current.province,e.address_city=this.address_current.city,e.address_area=this.address_current.area,e.address_content=this.address_current.address),e.coupon_id=this.coupon_id,e.integral=this.switchChecked?"1":"0",console.log(e),e.from_cart=this.from_cart,e},loadData:function(){var n=this,t=this.createParams();a.axios.post("/api/v1/user/order/confirm",t).then((function(e){if(1===e.code){var t=e.data,o=t.items,r=(t.express,t.coupon),u=t.total;n.total=Object.assign({},n.total,u),n.goods_list=o,n.coupon=r,n.loaded=!0,1===e.data.items.length&&"0.00"!==e.data.items[0].integral_limit&&(n.use_available=!0),console.log(n.coupon)}})).catch((function(n){console.log(n),e.showToast({title:"出错了，请稍后重试！",icon:"none",duration:1200})}))}}};n.default=d}).call(this,t("543d")["default"])},cf1f:function(e,n,t){"use strict";t.d(n,"b",(function(){return r})),t.d(n,"c",(function(){return u})),t.d(n,"a",(function(){return o}));var o={uLoadingPage:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-loading-page/u-loading-page")]).then(t.bind(null,"8282"))},uniTag:function(){return t.e("uni_modules/uni-tag/components/uni-tag/uni-tag").then(t.bind(null,"d078"))},"u-Text":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--text/u--text")]).then(t.bind(null,"1e4d"))},uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"4a55"))},uCellGroup:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-cell-group/u-cell-group")]).then(t.bind(null,"dee4"))},uCell:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-cell/u-cell")]).then(t.bind(null,"8968"))},uSwitch:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-switch/u-switch")]).then(t.bind(null,"f91e"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"4005"))},uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,"31f2"))},uniSegmentedControl:function(){return t.e("uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control").then(t.bind(null,"558a"))},uniCollapse:function(){return t.e("uni_modules/uni-collapse/components/uni-collapse/uni-collapse").then(t.bind(null,"6e18"))},uLine:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-line/u-line")]).then(t.bind(null,"4bfd"))},uniCollapseItem:function(){return t.e("uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item").then(t.bind(null,"2fd2"))},uEmpty:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-empty/u-empty")]).then(t.bind(null,"bf53"))}},r=function(){var e=this,n=e.$createElement,t=(e._self._c,e.loaded&&!e.coupon.used.id?e.coupon.available.length:null),o=e.loaded&&!e.coupon.used.id&&t>0?e.coupon.available.length:null,r=e.loaded?{"border-radius":"999px",width:"160rpx"}:null,u=e.coupon.available.length,i=e.coupon.unavailable.length;e.$mp.data=Object.assign({},{$root:{g0:t,g1:o,a0:r,g2:u,g3:i}})},u=[]}},[["1af6","common/runtime","common/vendor"]]]);